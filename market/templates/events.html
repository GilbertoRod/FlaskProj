{% extends 'base.html' %}

  {% block style %}
  <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/events.css') }}">
  {% endblock %}

  {% block title %}
  Secret Santa | Events
  {% endblock %}


  {% block content %}

  

  
    {% if events %}
    <center>
    <div class="create-btn-div-true">
    <a href="{{url_for('create_event')}}"><button class="create-btn-yes">Create Event +</button></a>
    </div>
      
      <div class="create-div">
      
      {% for event in events %}    
      <div class="event">
        <div class="titles-div">
          
          <h1 class="e-title"><span class="event-info-title">{{event.event_name|title}}</span></h1>
          <h1 class="e-title e-status"><i>Status: 
            
            
            {% if event.event_status|title=='Open' %}
              <span class="event-status-info-open">{{event.event_status|upper}}</i></span></h1><br>
            
              {% elif event.event_status|title=='Closed' %}
            <span class="event-status-info-closed">{{event.event_status|upper}}</i></span></h1><br>



            {% endif %}
            
          <h1 class="e-title">Event Coordinator: <span class="event-info">{{event.coordinator.username}}</span></h1>
          
          
          <h1 class="e-title"># of Members: <span class="event-info">
            {% set count = [] %}
            {% for person in event.members%}
             
              {% if person.status == 'member'%}
                {% set _ = count.append(person) %}
              {% endif %}
            {% endfor %}
            {{count|length}}
          </span></h1>
        </div>
        <br><br><br><br>
        <div class="buttons">

          
          {% if current_user.is_authenticated and current_user.id == event.coordinator.id %}
            <a href="{{ url_for('event_info', event_id=event.event_id) }}"><button class="edit-btn">Edit</button></a>
            <a href="{{ url_for('delete_event', event_id=event.event_id) }}"><button class="delete-btn">Delete Event</button></a>
            {% else %}
              <a href="{{ url_for('event_info', event_id=event.event_id) }}"><button class="info-btn">Info</button></a>
              

              
              {% if current_user.is_authenticated and event.event_status == 'open' %}
                {% set user_event_status=is_user_member(event, current_user) %}
                {% if user_event_status=='none' %}
                    <a href="{{ url_for('request_event', event_id=event.event_id, member_id=current_user.id) }}"><button class="request-btn">Request</button></a>
                {% elif user_event_status=='pending' %}
                <a href="{{ url_for('cancel_request', event_id=event.event_id) }}"><button class="remove-request-btn">Cancel Request</button></a>
                {% endif %}
              {% endif %}

              
            {% endif %}
        </div>
      </div>

      {% endfor %}
    </div></center>
    {% else %}
    <center>
    <div class="no-event-div">
    <p>Be the First To Create An Event!</p>
    
    <a href="{{url_for('create_event')}}"><button class="create-btn">Create Event +</button></a>
    </div></center>
    {% endif %}








  {% endblock %}
</body>
</html>